# 2.3.14 段階的設計書生成プロセス

## 目的

基本設計書（全13章）を確実に生成するため、段階的なプロセスを定義します。

**重要**: Claudeが途中で省略しないよう、明示的な生成手順とチェックリストを提供します。

---

## 📋 生成プロセス

### ステップ1: 骨格生成（必須）

**生成するファイル**:
- `docs/03_基本設計書/README.md` - 目次
- `docs/03_基本設計書/00_概要.md` - システム概要（短い）

**ユーザーへの宣言**:
```
基本設計書の生成を開始します。

全13章を段階的に生成します：
1. ✅ README.md（目次）
2. ✅ 00_概要.md（システム概要）
3. ⏭️ 01_制約事項・前提条件.md
...（以下、全13章リスト）

各章の生成後、進捗を報告します。
```

---

### ステップ2: コア設計生成（必須）

**生成順序** ⭐最重要:

#### 2-1. 制約事項・前提条件（基礎）
- `01_制約事項・前提条件.md`
- **なぜ最初に生成？**: 他の章の前提となる制約を明確化

#### 2-2. アーキテクチャ設計（最重要）
- `02_アーキテクチャ設計.md`
- **必須内容**:
  - 4.1.3 検討した代替案（表形式）
  - 4.1.4 トレードオフ（メリット・デメリット）
  - 4.2.3 検討した代替案（技術スタック）
  - 4.3 参照した技術標準

#### 2-3. システム構成図
- `03_システム構成図.md`
- **必須内容**: Mermaid図（5個以上）

**進捗報告**:
```
✅ コア設計（3章）完了
- ✅ 01_制約事項・前提条件.md
- ✅ 02_アーキテクチャ設計.md
- ✅ 03_システム構成図.md

次: 詳細設計（4章）を生成します
```

---

### ステップ3: 詳細設計生成（必須）

**生成順序**:

#### 3-1. データベース設計
- `04_データベース設計.md`
- **必須内容**: ER図、テーブル定義、選定理由（RDB vs NoSQL）

#### 3-2. API設計
- `05_API設計.md`
- **必須内容**: エンドポイント一覧、認証・認可方式、バージョニング戦略

#### 3-3. セキュリティ設計 ⭐⭐⭐
- `06_セキュリティ設計.md`
- **必須内容**: 技術標準 `4.9 セキュリティ・運用基準` 準拠確認

#### 3-4. 性能設計
- `07_性能設計.md`
- **必須内容**: レスポンスタイム目標、スループット、ボトルネック分析

**進捗報告**:
```
✅ 詳細設計（4章）完了
- ✅ 04_データベース設計.md
- ✅ 05_API設計.md
- ✅ 06_セキュリティ設計.md
- ✅ 07_性能設計.md

次: 運用設計（4章）を生成します
```

---

### ステップ4: 運用設計生成（必須）

**生成順序**:

#### 4-1. 運用設計
- `08_運用設計.md`
- **必須内容**: 監視、ログ、バックアップ、障害復旧

#### 4-2. インフラ設計・コスト設計 ⭐⭐
- `09_インフラ設計・コスト設計.md`
- **必須内容**: ベンダー選定、コスト試算（詳細）、最適化戦略

#### 4-3. 開発環境・CI/CD設計
- `10_開発環境・CI_CD設計.md`
- **必須内容**: CI/CDパイプライン、デプロイ戦略

#### 4-4. テスト戦略
- `11_テスト戦略.md`
- **必須内容**: テスト方針、テスト環境、テストデータ戦略

**進捗報告**:
```
✅ 運用設計（4章）完了
- ✅ 08_運用設計.md
- ✅ 09_インフラ設計・コスト設計.md
- ✅ 10_開発環境・CI_CD設計.md
- ✅ 11_テスト戦略.md

次: まとめ（1章）を生成します
```

---

### ステップ5: まとめ生成（必須）

**生成順序**:

#### 5-1. 非機能要件対応
- `12_非機能要件対応.md`
- **必須内容**: 性能、可用性、セキュリティ、運用要件への対応まとめ

**進捗報告**:
```
✅ まとめ（1章）完了
- ✅ 12_非機能要件対応.md

すべての章の生成が完了しました。
次: 完了確認を実施します
```

---

### ステップ6: 完了確認（必須）⭐⭐⭐

**チェックリスト**:
- [ ] README.md に全13章へのリンクがある
- [ ] 全13章のファイルが存在する
- [ ] 各章に「次のドキュメント」リンクがある
- [ ] アーキテクチャ設計に「検討した代替案」「トレードオフ」がある
- [ ] 技術標準参照が記載されている（最低3箇所）

**自動確認スクリプト**（Claudeが実行）:
```bash
ls -la docs/03_基本設計書/*.md | wc -l
# 期待値: 14ファイル（README.md + 13章）
```

**ユーザーへの最終報告**:
```
==================================
基本設計書生成完了
==================================

生成した章（13/13）:
✅ 00_概要.md
✅ 01_制約事項・前提条件.md
✅ 02_アーキテクチャ設計.md
✅ 03_システム構成図.md
✅ 04_データベース設計.md
✅ 05_API設計.md
✅ 06_セキュリティ設計.md
✅ 07_性能設計.md
✅ 08_運用設計.md
✅ 09_インフラ設計・コスト設計.md
✅ 10_開発環境・CI_CD設計.md
✅ 11_テスト戦略.md
✅ 12_非機能要件対応.md

参照した技術標準:
✅ 4.3 or 4.4 (CloudFormation/Terraform)
✅ 4.5/4.6/4.7/4.8 (言語規約)
✅ 4.9 セキュリティ・運用基準

次のステップ: 実装フェーズに進みます
==================================
```

---

## 🚨 省略防止策

### Claudeが途中で省略する理由

1. **コンテキスト長を意識しすぎる**
   - 「トークン消費が多いから省略しよう」と判断

2. **「重要な章だけでいい」と誤解**
   - 明示的な指示がないと、勝手に省略

3. **フェーズ完了基準が曖昧**
   - 「基本設計書が作成されている」だけでは不十分

### 対策

#### 対策1: 各章生成後に必ず進捗報告

**テンプレート**:
```
✅ [章番号]_[章名].md を生成しました（[N]/13完了）

次: [次の章番号]_[次の章名].md を生成します
```

#### 対策2: ユーザーに「全13章生成します」と宣言

**最初に必ず宣言**:
```
これから基本設計書を生成します。

全13章を順番に生成します。途中で省略せず、すべて生成します。
各章の生成後、進捗を報告します。

準備完了。生成を開始します。
```

#### 対策3: フェーズ完了基準で厳格にチェック

**`.claude/docs/10_facilitation/2.3_設計フェーズ/2.3.11_フェーズ完了基準.md`** で確認:
- ✅ 基本設計書の全13章が作成されている（個別にチェック）
- ❌ 「基本設計書が作成されている」だけではNG

---

## 🎯 Good Example

### 例: Round 2での実行

**ユーザーの指示**:
```
基本設計書を作成してください
```

**Claudeの応答**:
```
基本設計書の生成を開始します。

全13章を段階的に生成します：
✅ README.md（目次）
✅ 00_概要.md（システム概要）
⏭️ 01_制約事項・前提条件.md
⏭️ 02_アーキテクチャ設計.md
⏭️ 03_システム構成図.md
⏭️ 04_データベース設計.md
⏭️ 05_API設計.md
⏭️ 06_セキュリティ設計.md
⏭️ 07_性能設計.md
⏭️ 08_運用設計.md
⏭️ 09_インフラ設計・コスト設計.md
⏭️ 10_開発環境・CI_CD設計.md
⏭️ 11_テスト戦略.md
⏭️ 12_非機能要件対応.md

各章の生成後、進捗を報告します。
準備完了。生成を開始します。
```

**進捗報告（各章ごと）**:
```
✅ 01_制約事項・前提条件.md を生成しました（3/13完了）

次: 02_アーキテクチャ設計.md を生成します
```

**最終報告**:
```
==================================
基本設計書生成完了
==================================

生成した章（13/13）:
✅ 00_概要.md
✅ 01_制約事項・前提条件.md
✅ 02_アーキテクチャ設計.md
✅ 03_システム構成図.md
✅ 04_データベース設計.md
✅ 05_API設計.md
✅ 06_セキュリティ設計.md
✅ 07_性能設計.md
✅ 08_運用設計.md
✅ 09_インフラ設計・コスト設計.md
✅ 10_開発環境・CI_CD設計.md
✅ 11_テスト戦略.md
✅ 12_非機能要件対応.md

次のステップ: 実装フェーズに進みます
==================================
```

---

## ❌ Bad Example

### 例: Round 1での実行（省略された）

**Claudeの応答**:
```
基本設計書を生成します。

（README.md, 00_概要.md, 02_アーキテクチャ設計.md, 03_システム構成図.md を生成）

基本設計書の生成が完了しました。
次のステップ: 実装フェーズに進みます。
```

**問題点**:
- ❌ 13章中4章しか生成されていない（31%）
- ❌ 進捗報告がない
- ❌ 「全13章生成します」という宣言がない
- ❌ 完了確認がない

---

**作成日**: 2025-10-24
**対象フェーズ**: 設計
**重要度**: ⭐⭐⭐ 必須（Round 2で最優先）
