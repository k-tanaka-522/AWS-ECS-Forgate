# 非機能要件書

## プロジェクト概要

**システム名**: 介護保険申請管理システム（PC Web版）
**目的**: 市が介護事業者からの保険申請を管理するシステム
**背景**: 既存iPad版（専用端末配布）からPC Web版への改修
**作成日**: 2025-09-30

---

## 1. 可用性・信頼性

### 1.1 稼働時間
- **重要稼働時間**: 平日 + 土曜日（市庁舎業務時間 8:30-17:30を最優先）
- **推奨稼働時間**: 夜間・日曜日も極力アクセス可能にする
- **メンテナンス**: 日曜深夜または祝日に実施

### 1.2 目標稼働率
- **本番環境**: 99.5%以上（年間ダウンタイム約43.8時間）
- **開発環境**: 95%以上（コスト優先）

### 1.3 障害復旧
- **目標復旧時間（RTO）**: 6時間以内
- **データ損失許容（RPO）**: 1時間以内
- **Multi-AZ構成**: RDS（本番）、ECS Fargateタスク（本番）

---

## 2. 性能

### 2.1 応答時間
- **画面遷移**: 2秒以内
- **検索処理**: 5秒以内
- **PDF生成**: 10秒以内
- **バッチ処理**: 夜間6時間以内に完了

### 2.2 スループット
- **同時接続ユーザー数**:
  - 市職員: 10-50名
  - 事業者: 50-200社
  - 合計: 最大250名
- **ピーク時トランザクション**: 500件/時
- **平均トランザクション**: 100件/時

### 2.3 データ量
- **想定申請件数**: 月間2,000-5,000件
- **年間申請件数**: 約30,000-60,000件
- **保管期間**: 5-7年
- **想定データ量**: 5年で約200,000-300,000件

---

## 3. セキュリティ

### 3.1 データ分類
- **個人情報**: あり
- **要配慮個人情報**: あり（介護情報、健康情報）
- **セキュリティレベル**: 高（行政システム相当）

### 3.2 暗号化
- **転送時**: TLS 1.2以上（HTTPS通信）
- **保管時**:
  - RDS: 暗号化有効（AWS KMS）
  - EBS: 暗号化有効
  - S3: 暗号化有効（バックアップ用途）

### 3.3 認証・認可
- **認証基盤**: Amazon Cognito User Pool
- **ユーザーグループ**:
  - Administrators（市職員）
  - BusinessUsers（事業者）
- **MFA**:
  - 市職員: 推奨（将来的に必須化検討）
  - 事業者: オプション
- **パスワードポリシー**:
  - 最小8文字以上
  - 大文字・小文字・数字・記号を含む
  - 90日ごとに変更推奨

### 3.4 アクセス制御
- **市職員**:
  - POC: Client VPN経由でVPCにアクセス
  - 本番: Direct Connect → Transit Gateway → VPC
- **事業者**:
  - インターネット経由
  - WAF（AWS WAF）でSQLインジェクション、XSS等を防御
- **ネットワーク分離**:
  - Public Subnet: ALBのみ
  - Private Subnet (App): ECS Fargateタスク
  - Private Subnet (DB): RDS
- **セキュリティグループ**: 最小権限の原則（ALB→ECS→RDS）

### 3.5 監査ログ
- **記録対象**:
  - ユーザーログイン・ログアウト
  - 申請の作成・更新・削除
  - 承認・却下・差し戻し操作
  - マスタデータの変更
  - システム設定変更
- **ログ保管**:
  - CloudWatch Logs: 90日
  - S3アーカイブ: 7年
- **AWS監査ログ**:
  - CloudTrail: 有効（全API操作記録）
  - VPC Flow Logs: 有効（ネットワークトラフィック記録）

### 3.6 その他セキュリティ対策
- **Secrets Manager**: DB接続情報、APIキー管理
- **GuardDuty**: 脅威検知（本番環境）
- **Config**: コンプライアンスチェック（本番環境）
- **Session Manager**: 踏み台サーバー不要のセキュアアクセス

---

## 4. バックアップ・DR（災害復旧）

### 4.1 バックアップ
- **RDS自動バックアップ**:
  - 頻度: 日次
  - 保管期間: 30日
  - バックアップウィンドウ: 深夜2:00-3:00
- **RDS手動スナップショット**:
  - 頻度: 週次（日曜深夜）
  - 保管期間: 3ヶ月
- **アプリケーションデータ**:
  - S3バケットにエクスポート（週次）
  - バージョニング有効

### 4.2 DR（災害復旧）
- **プライマリリージョン**: ap-northeast-1（東京）
- **DRリージョン**: ap-northeast-3（大阪）
- **DR戦略**: Backup & Restore（コスト優先）
  - RDSスナップショットを大阪リージョンにコピー（日次）
  - 災害時は大阪リージョンで手動復旧
  - 復旧時間: 6時間以内（RTO）

### 4.3 バックアップテスト
- **頻度**: 四半期に1回
- **内容**: スナップショットからの復元テスト

---

## 5. 運用・監視

### 5.1 監視項目
- **インフラメトリクス**:
  - ECS: CPU使用率、メモリ使用率、タスク数
  - RDS: CPU使用率、接続数、ストレージ使用量
  - ALB: リクエスト数、レイテンシ、エラー率
- **アプリケーションメトリクス**:
  - エラーログ
  - レスポンスタイム
  - トランザクション数
- **セキュリティ**:
  - WAFブロック数
  - GuardDuty検知
  - 不正ログイン試行

### 5.2 アラート
- **通知先**:
  - Email: 運用チーム
  - Slack: 開発チーム（将来対応）
- **アラート条件**:
  - ECS CPU使用率 > 80%（5分継続）
  - RDS CPU使用率 > 80%（5分継続）
  - ALB 5xxエラー率 > 5%（5分継続）
  - RDS接続数 > 80%上限
  - ディスク使用率 > 80%

### 5.3 ログ管理
- **CloudWatch Logs**:
  - ECSタスクログ
  - RDSクエリログ（スロークエリのみ）
  - WAFログ
  - 保管期間: 90日
- **S3アーカイブ**:
  - 90日経過後、S3に移動
  - 保管期間: 7年
  - ストレージクラス: Glacier

### 5.4 AI運用支援
- **Amazon Bedrock**:
  - 異常検知時の原因分析
  - 対応策の提案
  - ログ分析の自動化
  - 将来的な予測分析

---

## 6. 拡張性

### 6.1 スケーラビリティ
- **ECS Fargate Auto Scaling**:
  - Frontend: 2-6タスク（CPU 70%でスケールアウト）
  - Backend: 2-8タスク（CPU 70%でスケールアウト）
- **RDS**:
  - 初期: db.t3.medium（本番）、db.t3.micro（開発）
  - 拡張: db.m5.largeまで垂直スケーリング
  - リードレプリカ追加可能
- **利用者増加対応**: 500名まで対応可能

### 6.2 機能拡張性
- **メール通知カスタマイズ**:
  - 通知テンプレートをDBで管理
  - 管理画面から編集可能
- **帳票テンプレート**:
  - 帳票レイアウトをS3で管理
  - 柔軟な変更が可能
- **API拡張**:
  - RESTful API設計
  - 将来的な外部システム連携を考慮

---

## 7. 開発・デプロイ

### 7.1 環境構成
- **開発環境**:
  - 1つのAWSアカウント
  - Single-AZ構成（コスト優先）
  - Client VPN経由でアクセス
- **本番環境**:
  - 別のAWSアカウント
  - Multi-AZ構成（冗長化）
  - Direct Connect + Transit Gateway経由

### 7.2 CI/CD
- **開発環境**:
  - Git push/マージで自動デプロイ
  - GitHub Actions（予定）
  - テスト自動実行
- **本番環境**:
  - 手動承認フロー
  - ステージングブランチからリリース
  - デプロイ前にdry-run実施

### 7.3 IaC（Infrastructure as Code）
- **ツール**: AWS CDK（TypeScript）
- **バージョン管理**: Git
- **環境差分管理**: CDK Context（dev/prod）

---

## 8. コスト

### 8.1 月額コスト見積もり

#### 開発環境（最小構成）
- ECS Fargate: ~2,000円
- RDS (db.t3.micro Single-AZ): ~2,000円
- ALB: ~2,500円
- Client VPN: ~5,000円
- その他（Cognito, CloudWatch等）: ~1,000円
- **合計**: 約12,500円/月

#### 本番環境（大規模構成）
- ECS Fargate (Auto Scaling): ~15,000円
- RDS (db.m5.large Multi-AZ): ~30,000円
- ALB: ~2,500円
- Direct Connect (共有): ~50,000円（※別プロジェクトと按分）
- Transit Gateway: ~10,000円
- WAF: ~5,000円
- S3 (バックアップ): ~3,000円
- CloudWatch Logs: ~2,000円
- その他（Cognito, Secrets Manager等）: ~2,000円
- **合計**: 約120,000円/月（Direct Connect按分前）
- **合計**: 約70,000円/月（Direct Connect按分後）

### 8.2 コスト最適化
- **リザーブドインスタンス**: RDSで1年契約（約30%削減）
- **Savings Plans**: ECS Fargateで1年契約（約20%削減）
- **S3ライフサイクル**: 90日後にGlacierへ移行
- **CloudWatch Logs**: 不要なログは無効化

---

## 9. コンプライアンス

### 9.1 個人情報保護
- **個人情報保護法**: 準拠
- **自治体個人情報保護条例**: 準拠
- **データ保管**: 日本国内のみ（東京・大阪リージョン）

### 9.2 情報セキュリティ基準
- **政府情報システムのためのセキュリティ評価制度（ISMAP）**: 参考
- **自治体情報セキュリティクラウド**: 参考

---

## 10. 制約事項

### 10.1 POC段階の制約
- Direct Connect未構築（Client VPN代替）
- Transit Gateway未構築（POCではVPC単体）
- 開発環境のみで動作確認

### 10.2 本番移行時の対応
- Client VPN → Direct Connect + Transit Gateway
- 共有系AWSアカウントの構築
- Transit Gateway Attachment設定

---

## 11. 参考情報

### 11.1 類似システム事例
- 自治体介護保険システム
- 行政申請管理システム

### 11.2 技術標準
- AWS Well-Architected Framework
- 12 Factor App
- REST API設計原則

---

**承認者**: （承認後に記入）
**承認日**: （承認後に記入）