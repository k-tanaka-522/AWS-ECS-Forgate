# Sample App 企画書

## 1. プロジェクト概要

### 1.1 プロジェクト名
**AWS Multi-Account Sample Application（PC Web版）- Sample App**

### 1.2 背景
- **現状**: 組織が一般ユーザーからのデータを管理する既存システム（iPad版）を運用中
- **課題**:
  - 専用端末（iPad）配布によるコスト負担
  - 事業者側の操作性・利便性の問題
  - 組織職員の業務効率化の必要性
- **移行理由**: iPad版からPC Web版への改修により、利便性向上とコスト削減を実現

### 1.3 目的
1. **事業者の利便性向上**
   - PC Webブラウザからアクセス可能
   - 専用端末不要
   - 複数拠点からのアクセス

2. **組織職員の業務効率化**
   - 申請管理の効率化
   - 承認ワークフローの自動化
   - リアルタイムな状況把握

3. **コスト削減**
   - 専用端末配布の廃止
   - クラウドインフラによる運用コスト最適化

### 1.4 スコープ

#### Phase 1: POC環境（本ドキュメント対象）
- 1つのAWSアカウントで構築
- 共有系VPC + アプリ系VPCの構成検証
- Transit Gateway、Client VPNの動作確認
- 最小構成（Single-AZ、db.t3.micro等）

#### Phase 2: 本番環境（将来）
- 共有系 + 本番用の2アカウント構成
- Direct Connect + Transit Gateway
- Multi-AZ構成
- WAF、GuardDuty等のセキュリティ強化

---

## 2. ステークホルダー

### 2.1 主要ユーザー

#### 組織職員（管理者）
- **人数**: 10-50名
- **役割**: 申請の審査・承認、事業者管理
- **アクセス方法**:
  - POC: Client VPN経由
  - 本番: Direct Connect経由

#### 一般ユーザー（一般ユーザー）
- **事業者数**: 50-200社
- **役割**: 申請の作成・提出、審査状況確認
- **アクセス方法**: インターネット経由（HTTPS）

### 2.2 その他関係者
- インフラチーム: AWS環境構築・運用
- アプリ開発チーム: Frontend/Backend開発
- セキュリティ監査チーム: コンプライアンス確認

---

## 3. ビジネス要件

### 3.1 機能要件（概要）

#### 申請管理機能
- 申請の作成・編集・削除（下書き保存）
- 申請の提出
- 申請一覧・詳細表示
- 検索・絞り込み

#### 承認ワークフロー
- 組織職員による審査・承認
- 承認・却下・差し戻し
- コメント機能
- 履歴管理

#### 通知機能
- 申請提出時の通知（組織職員宛）
- 承認/却下時の通知（事業者宛）
- メールテンプレート管理

#### 帳票出力
- 申請書PDF生成
- 一覧CSV出力

#### マスタ管理
- 事業者マスタ
- サービス種別マスタ
- ユーザー管理

### 3.2 非機能要件（概要）
詳細は [01_非機能要件.md](01_非機能要件.md) を参照。

- **稼働時間**: 平日+土曜 8:30-17:30を最優先、それ以外も極力アクセス可能
- **目標稼働率**: 本番 99.5%以上
- **同時接続ユーザー**: 最大250名
- **データ保管期間**: 5-7年
- **セキュリティレベル**: 高（行政システム相当）
- **個人情報**: あり（要配慮個人情報含む）

---

## 4. 技術方針

### 4.1 アーキテクチャ

#### ネットワーク構成
- **Shared VPC**: Client VPN、Transit Gateway配置
- **App VPC**: アプリケーション本体
- **接続**: Transit Gatewayでの接続（Hub-and-Spoke）

#### アプリケーション構成
- **Frontend**: React（SPA）
- **Backend**: Node.js/Python（RESTful API）
- **Database**: PostgreSQL 15（RDS）
- **認証**: Amazon Cognito User Pool
- **ファイル保存**: Amazon S3
- **メール送信**: Amazon SES
- **バッチ処理**: ECS Task（EventBridge起動）

#### インフラ
- **IaCツール**: AWS CloudFormation（ネストスタック構成）
- **コンテナオーケストレーション**: ECS Fargate
- **ロードバランサー**: Application Load Balancer
- **監視**: CloudWatch、Amazon Bedrock（AI運用支援）

### 4.2 環境戦略

| 環境 | AWSアカウント | 構成 | 用途 |
|-----|------------|------|-----|
| POC | 1アカウント | Single-AZ | 動作検証、開発 |
| 本番 | 2アカウント（共有系+本番） | Multi-AZ | 本番運用 |

### 4.3 CI/CD
- **ツール**: GitHub Actions
- **デプロイフロー**:
  - 開発: feature → develop → 自動デプロイ
  - 本番: staging → main → 承認後デプロイ

---

## 5. プロジェクト計画

### 5.1 フェーズ構成

#### Phase 1: POC環境構築（現在）
- **期間**: 2ヶ月
- **内容**:
  - Shared VPCネットワーク構築 ✅
  - Transit Gateway構築 ✅
  - Client VPN構築 ✅
  - App VPCネットワーク構築 ⏳
  - ECS、RDS、Cognito等のアプリ基盤構築 ⏳
  - CI/CDパイプライン構築 ⏳

#### Phase 2: アプリケーション開発
- **期間**: 3ヶ月
- **内容**:
  - Frontend開発（React）
  - Backend開発（Node.js/Python）
  - DB設計・マイグレーション
  - 認証機能実装

#### Phase 3: テスト・調整
- **期間**: 1ヶ月
- **内容**:
  - 単体テスト、結合テスト
  - パフォーマンステスト
  - セキュリティテスト

#### Phase 4: 本番環境構築・移行
- **期間**: 2ヶ月
- **内容**:
  - 本番AWSアカウント構築
  - Direct Connect接続
  - データ移行
  - 本番リリース

### 5.2 現在の進捗状況

**現在のフェーズ**: Phase 1（POC環境構築）

**完了済み**:
- ✅ Shared VPCネットワーク
- ✅ Transit Gateway
- ✅ Client VPN

**進行中**:
- 🔄 App VPC構築
- 🔄 アプリ基盤（ECS、RDS、Cognito）構築
- 🔄 CI/CD構築

---

## 6. リスクと対策

### 6.1 技術リスク

| リスク | 影響 | 対策 |
|-------|-----|-----|
| Transit Gateway設定ミス | ネットワーク疎通不可 | POC環境で十分に検証 |
| RDSパフォーマンス不足 | レスポンス遅延 | CloudWatch監視、適切なスケーリング |
| セキュリティ脆弱性 | 情報漏洩リスク | WAF、GuardDuty、定期監査 |

### 6.2 運用リスク

| リスク | 影響 | 対策 |
|-------|-----|-----|
| 障害発生時の復旧遅延 | 業務停止 | Multi-AZ構成、バックアップ戦略 |
| コスト超過 | 予算オーバー | タグベースのコスト管理、定期レビュー |

---

## 7. 成功基準

### 7.1 POC環境（Phase 1）
- ✅ Shared VPCとApp VPCがTransit Gatewayで接続できること
- ⏳ Client VPN経由でApp VPCのリソースにアクセスできること
- ⏳ ECS Fargateでアプリケーションが動作すること
- ⏳ RDS PostgreSQLにアプリから接続できること
- ⏳ Cognito認証が機能すること

### 7.2 本番環境（Phase 4）
- 目標稼働率 99.5%以上を達成
- レスポンスタイム目標値を満たす
- セキュリティ監査に合格
- コスト見積もり内での運用

---

## 8. コスト見積もり

### 8.1 POC環境
- **月額**: 約12,500円
  - ECS Fargate: 2,000円
  - RDS (db.t3.micro): 2,000円
  - ALB: 2,500円
  - Client VPN: 5,000円
  - その他: 1,000円

### 8.2 本番環境
- **月額**: 約70,000円（Direct Connect按分後）
  - ECS Fargate: 15,000円
  - RDS (db.m5.large Multi-AZ): 30,000円
  - ALB: 2,500円
  - Direct Connect按分: 10,000円
  - Transit Gateway: 10,000円
  - WAF、その他: 12,500円

---

## 9. 関連ドキュメント

- [01_非機能要件.md](01_非機能要件.md) - 詳細な非機能要件
- [02_AWS構成図.md](02_AWS構成図.md) - AWS構成図・ネットワーク設計
- [03_データモデル設計.md](03_データモデル設計.md) - データベース設計
- [infra/README.md](../infra/README.md) - インフラ構築手順

---

**作成日**: 2025-10-01
**承認者**: （承認後に記入）
**承認日**: （承認後に記入）
