# テスト計画書

> AWS Multi-Account Sample Application

---

## ドキュメント情報

| 項目 | 内容 |
|------|------|
| プロジェクト名 | AWS Multi-Account Sample Application |
| 文書バージョン | 1.0 |
| 作成日 | 2025-10-22 |
| 承認状態 | 承認待ち |

---

## 1. テスト概要

### 1.1 テスト目的

本テスト計画書は、AWS Multi-Account Sample Application の品質を保証するため、以下の目的でテストを実施します：

1. **機能要件の充足確認**：要件定義書で定義された機能が正しく実装されているか
2. **非機能要件の充足確認**：性能、セキュリティ、可用性が要件を満たしているか
3. **インテグレーション確認**：複数コンポーネント間の連携が正しく動作するか
4. **デグレード検知**：変更による既存機能への影響がないか

### 1.2 テスト対象範囲

| カテゴリ | 対象 | 備考 |
|---------|------|------|
| **インフラ** | CloudFormation スタック | Platform, Service Account |
| **データベース** | RDS PostgreSQL | テーブル、インデックス、制約 |
| **アプリケーション** | Public Web, Admin Dashboard, Batch | 3サービス |
| **ネットワーク** | Transit Gateway, VPN | 拠点間接続 |
| **監視** | CloudWatch Alarms, Dashboard | アラート、メトリクス |

### 1.3 テスト対象外

本プロジェクトは検証・デモ用のため、以下は対象外とします：

- 負荷テスト（大規模トラフィック）
- 脆弱性診断（ペネトレーションテスト）
- UI/UXテスト（フロントエンドが存在しないため）
- 本番運用における24時間365日の耐久テスト

---

## 2. テスト戦略

### 2.1 テストレベル

```
┌────────────────────────────────────┐
│ E2Eテスト                          │  ← 最も重要（検証・デモ）
├────────────────────────────────────┤
│ インテグレーションテスト            │
├────────────────────────────────────┤
│ 単体テスト                          │
└────────────────────────────────────┘
```

**優先順位**（検証・デモ用）:
1. **E2Eテスト**: システム全体が正しく動作するか（最優先）
2. **インテグレーションテスト**: API、DB連携が正しく動作するか
3. **単体テスト**: 個別関数が正しく動作するか

### 2.2 テストタイプ

| テストタイプ | 目的 | 実施タイミング | 担当 |
|------------|------|--------------|------|
| **単体テスト** | 関数・メソッド単位の動作確認 | 実装中 | 開発者 |
| **インテグレーションテスト** | API、DB連携の動作確認 | 実装完了後 | 開発者 |
| **E2Eテスト** | システム全体の動作確認 | デプロイ後 | QA担当 |
| **性能テスト** | レスポンスタイム確認 | デプロイ後 | QA担当 |
| **セキュリティテスト** | 基本的なセキュリティ確認 | デプロイ後 | QA担当 |
| **インフラテスト** | CloudFormation構築確認 | デプロイ時 | インフラ担当 |

---

## 3. テスト環境

### 3.1 環境構成

| 環境 | 用途 | AWSアカウント | デプロイタイミング |
|------|------|-------------|----------------|
| **Dev** | 開発・動作確認 | Platform (Dev), Service (Dev) | 随時 |
| **Prod** | 本番・デモ | Platform (Prod), Service (Prod) | リリース時 |

### 3.2 テストデータ

| データ種別 | 件数 | 作成方法 | 備考 |
|-----------|------|---------|------|
| ユーザー | 10件 | シードデータ | 初期データ投入 |
| 商品 | 20件 | シードデータ | 初期データ投入 |
| 注文 | 100件 | スクリプト生成 | ランダムデータ |
| 注文明細 | 300件 | スクリプト生成 | 注文に紐づく |

**シードデータ配置**:
```
app/shared/db/seeds/dev/
└── 01_sample_data.js
```

---

## 4. テスト項目

### 4.1 インフラテスト

**参照**: [02_インフラテスト仕様書.md](02_インフラテスト仕様書.md)

| テスト項目 | 確認内容 | 期待結果 |
|-----------|---------|---------|
| VPC作成 | VPC、Subnet、Route Table | CIDR、AZ配置が正しい |
| Transit Gateway | TGW、Attachment、Route | ルーティングが正しい |
| RDS作成 | RDS PostgreSQL、Multi-AZ | 接続可能、暗号化有効 |
| ECS Fargate | Task Definition、Service、ALB | Healthyステータス |
| CloudWatch | Alarms、Dashboard | メトリクス収集、アラート動作 |

### 4.2 単体テスト

**参照**: [03_単体テスト仕様書.md](03_単体テスト仕様書.md)

| テスト対象 | テスト項目数 | カバレッジ目標 |
|-----------|-----------|--------------|
| User Service | 15項目 | 80%以上 |
| Product Service | 12項目 | 80%以上 |
| Order Service | 20項目 | 80%以上 |
| Batch Jobs | 10項目 | 70%以上 |

**テストフレームワーク**: Jest

### 4.3 インテグレーションテスト

**参照**: [04_インテグレーションテスト仕様書.md](04_インテグレーションテスト仕様書.md)

| テスト対象 | テスト項目数 | 確認内容 |
|-----------|-----------|---------|
| User API | 10項目 | CRUD操作、認証 |
| Product API | 8項目 | CRUD操作、在庫管理 |
| Order API | 12項目 | 注文作成、ステータス更新 |
| Batch処理 | 5項目 | 統計集計、クリーンアップ |

**テストツール**: Supertest（Node.js）

### 4.4 E2Eテスト

**参照**: [05_E2Eテスト仕様書.md](05_E2Eテスト仕様書.md)

| シナリオ | 確認内容 |
|---------|---------|
| ユーザー登録〜注文完了 | Public Web経由で注文完了まで |
| 管理者ダッシュボード確認 | VPN経由でAdmin Dashboard アクセス |
| バッチ処理実行 | 統計集計が正しく実行される |
| Transit Gateway接続確認 | Platform ⇔ Service VPC 接続 |

---

## 5. テスト実施スケジュール

### 5.1 タイムライン

```
Week 1-2: 実装
  ├── 単体テスト（実装と並行）
  └── インフラテスト（デプロイ時）

Week 3: テスト
  ├── インテグレーションテスト
  ├── E2Eテスト
  └── 性能テスト

Week 4: 修正・再テスト
  ├── バグ修正
  └── 回帰テスト
```

### 5.2 テストマイルストーン

| マイルストーン | 完了基準 | 期限 |
|--------------|---------|------|
| インフラテスト完了 | 全スタックデプロイ成功 | Week 2 |
| 単体テスト完了 | カバレッジ70%以上 | Week 2 |
| インテグレーションテスト完了 | 全API動作確認 | Week 3 |
| E2Eテスト完了 | 全シナリオ成功 | Week 3 |
| テスト完了 | バグ修正完了 | Week 4 |

---

## 6. テストツール

### 6.1 自動テストツール

| ツール | 用途 | 言語 |
|-------|------|------|
| **Jest** | 単体テスト、インテグレーションテスト | TypeScript/JavaScript |
| **Supertest** | API テスト | TypeScript/JavaScript |
| **AWS CLI** | インフラテスト | Bash |
| **curl** | APIエンドポイント確認 | Bash |

### 6.2 手動テストツール

| ツール | 用途 |
|-------|------|
| **Postman** | API動作確認 |
| **AWS Console** | インフラ構成確認 |
| **CloudWatch Console** | ログ・メトリクス確認 |
| **Client VPN Client** | VPN接続確認 |

---

## 7. テスト合格基準

### 7.1 テストレベル別合格基準

| テストレベル | 合格基準 |
|------------|---------|
| **単体テスト** | カバレッジ70%以上、全テストケース成功 |
| **インテグレーションテスト** | 全API正常動作、エラーハンドリング確認 |
| **E2Eテスト** | 全シナリオ成功、レスポンスタイム3秒以内 |
| **インフラテスト** | 全スタックデプロイ成功、Healthチェック通過 |

### 7.2 バグ重要度と対応方針

| 重要度 | 定義 | 対応方針 |
|-------|------|---------|
| **Critical** | システムダウン、データ損失 | 即時修正 |
| **High** | 主要機能が動作しない | リリース前に修正 |
| **Medium** | 一部機能に不具合 | 可能であれば修正 |
| **Low** | UIの軽微な不具合 | 次回リリースで修正 |

### 7.3 リリース判定基準

以下の条件を **全て** 満たすこと：

- [ ] Critical / High バグが0件
- [ ] 全E2Eテストシナリオが成功
- [ ] インフラテスト全項目成功
- [ ] レスポンスタイム3秒以内（90%ile）
- [ ] CloudWatch Alarms が正常動作

---

## 8. テスト実施体制

### 8.1 役割と責任

| 役割 | 担当者 | 責任範囲 |
|------|-------|---------|
| **テスト責任者** | QAリード | テスト計画策定、進捗管理 |
| **インフラテスト** | インフラエンジニア | CloudFormation、ネットワーク |
| **単体テスト** | 開発者 | コード品質、カバレッジ |
| **インテグレーションテスト** | 開発者・QA | API動作確認 |
| **E2Eテスト** | QA担当 | シナリオテスト |

### 8.2 コミュニケーション

| 項目 | 頻度 | 参加者 |
|------|------|--------|
| テスト進捗会議 | 週次 | 全員 |
| バグレビュー会議 | 随時 | テスト責任者、開発者 |
| リリース判定会議 | リリース前 | 全員 |

---

## 9. リスクと対策

### 9.1 テストリスク

| リスク | 影響度 | 対策 |
|-------|-------|------|
| **テスト環境構築遅延** | 高 | 早期にインフラ構築、自動化 |
| **テストデータ不足** | 中 | シードデータスクリプト準備 |
| **テスト時間不足** | 中 | 優先度を明確化、E2Eテスト優先 |
| **バグ修正による新たなバグ** | 高 | 回帰テスト自動化 |

---

## 10. テスト成果物

### 10.1 テストドキュメント

- [x] テスト計画書（本ドキュメント）
- [ ] インフラテスト仕様書
- [ ] 単体テスト仕様書
- [ ] インテグレーションテスト仕様書
- [ ] E2Eテスト仕様書
- [ ] テスト実施報告書

### 10.2 テストコード

```
tests/
├── unit/                       # 単体テスト
│   ├── domain/
│   │   ├── user.service.test.ts
│   │   ├── product.service.test.ts
│   │   └── order.service.test.ts
│   └── infrastructure/
│       └── repositories/
│           ├── user.repository.test.ts
│           └── product.repository.test.ts
├── integration/                # インテグレーションテスト
│   └── api/
│       ├── users.api.test.ts
│       ├── products.api.test.ts
│       └── orders.api.test.ts
└── e2e/                        # E2Eテスト
    ├── user-registration-to-order.test.ts
    ├── admin-dashboard.test.ts
    └── batch-processing.test.ts
```

---

## 11. 参考資料

- [要件定義書](../02_要件定義書.md) - 機能要件、非機能要件
- [基本設計書](../03_基本設計書/00_目次.md) - システム設計
- [詳細設計書](../04_詳細設計書/) - 実装仕様
- [運用マニュアル](../06_納品物/03_運用マニュアル.md) - 運用手順

---

## 変更履歴

| 日付 | 版数 | 変更内容 | 承認者 |
|------|------|----------|--------|
| 2025-10-22 | 1.0 | 初版作成 | - |
