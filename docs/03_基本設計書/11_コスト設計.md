# 11. コスト設計

[← 前へ: 10_非機能要件対応](10_非機能要件対応.md) | [目次](00_目次.md) | [次へ: 12_移行・展開戦略 →](12_移行・展開戦略.md)

---

## 11.1 月額コスト見積もり

### 11.1.1 総括

| カテゴリ | 月額コスト（USD） | 割合 |
|---------|----------------|------|
| コンピュート（ECS Fargate） | $47 | 10% |
| データベース（RDS） | $154 | 33% |
| ネットワーク（NAT Gateway, TGW, VPN） | $235 | 50% |
| その他（ALB, CloudWatch, ECR） | $32 | 7% |
| **合計** | **$468** | **100%** |

**備考**: データ転送料、S3ストレージ等は除く

---

## 11.2 詳細コスト内訳

### 11.2.1 コンピュート（ECS Fargate）

#### Public Web Service

| 項目 | 仕様 | 単価 | 月額 |
|------|------|------|------|
| vCPU | 0.5 vCPU × 2 Tasks × 720h | $0.04048/vCPU/h | $29.15 |
| Memory | 1 GB × 2 Tasks × 720h | $0.004445/GB/h | $6.40 |
| **小計** | | | **$35.55** |

#### Admin Service

| 項目 | 仕様 | 単価 | 月額 |
|------|------|------|------|
| vCPU | 0.5 vCPU × 1 Task × 720h | $0.04048/vCPU/h | $14.57 |
| Memory | 1 GB × 1 Task × 720h | $0.004445/GB/h | $3.20 |
| **小計** | | | **$17.77** |

#### Batch Service

| 項目 | 仕様 | 単価 | 月額 |
|------|------|------|------|
| vCPU | 1.0 vCPU × 1h/day × 30日 | $0.04048/vCPU/h | $1.21 |
| Memory | 2 GB × 1h/day × 30日 | $0.004445/GB/h | $0.27 |
| **小計** | | | **$1.48** |

**ECS Fargate合計**: **$54.80**

### 11.2.2 データベース（RDS PostgreSQL）

| 項目 | 仕様 | 単価 | 月額 |
|------|------|------|------|
| Instance | db.t3.medium Multi-AZ | $0.170/h × 720h | $122.40 |
| Storage | 100 GB gp3 Multi-AZ | $0.23/GB/month | $23.00 |
| Backup Storage | 100 GB（7日分想定） | $0.095/GB/month | $9.50 |
| Data Transfer | 10 GB/month（想定） | $0.09/GB | $0.90 |
| **合計** | | | **$155.80** |

### 11.2.3 ネットワーク

#### NAT Gateway

| 項目 | 仕様 | 単価 | 月額 |
|------|------|------|------|
| Platform Account | 2台（Multi-AZ） | $0.059/h × 2 × 720h | $84.96 |
| Service Account | 2台（Multi-AZ） | $0.059/h × 2 × 720h | $84.96 |
| Data Processing | 50 GB/month（想定） | $0.059/GB | $2.95 |
| **小計** | | | **$172.87** |

#### Transit Gateway

| 項目 | 仕様 | 単価 | 月額 |
|------|------|------|------|
| Attachment | 2個（Shared VPC, Service VPC） | $0.07/h × 2 × 720h | $100.80 |
| Data Processing | 10 GB/month（想定） | $0.02/GB | $0.20 |
| **小計** | | | **$101.00** |

#### Client VPN

| 項目 | 仕様 | 単価 | 月額 |
|------|------|------|------|
| Endpoint | 1個 | $0.10/h × 720h | $72.00 |
| Connection | 5接続（想定） | $0.05/h/connection × 5 × 720h | $180.00 |
| **小計** | | | **$252.00** |

**ネットワーク合計**: **$525.87**

### 11.2.4 ロードバランサー（ALB）

| 項目 | 仕様 | 単価 | 月額 |
|------|------|------|------|
| ALB | 1台 | $0.0243/h × 720h | $17.50 |
| LCU | 0.5 LCU × 720h（想定） | $0.008/LCU/h × 0.5 × 720h | $2.88 |
| **合計** | | | **$20.38** |

### 11.2.5 監視・ログ（CloudWatch）

| 項目 | 仕様 | 単価 | 月額 |
|------|------|------|------|
| Logs Ingestion | 10 GB/month | $0.50/GB | $5.00 |
| Logs Storage | 10 GB（7日保持） | $0.03/GB/month | $0.30 |
| Metrics | 50 Custom Metrics | $0.30/metric/month | $15.00 |
| Alarms | 20 Alarms | $0.10/alarm/month | $2.00 |
| Dashboard | 3 Dashboards | 最初3個無料 | $0.00 |
| **合計** | | | **$22.30** |

### 11.2.6 コンテナレジストリ（ECR）

| 項目 | 仕様 | 単価 | 月額 |
|------|------|------|------|
| Storage | 3 GB（3サービス × 10イメージ） | $0.10/GB/month | $0.30 |
| Data Transfer | 5 GB/month | $0.09/GB | $0.45 |
| **合計** | | | **$0.75** |

---

## 11.3 月額コスト合計

| カテゴリ | 月額（USD） |
|---------|-----------|
| ECS Fargate | $54.80 |
| RDS PostgreSQL | $155.80 |
| NAT Gateway | $172.87 |
| Transit Gateway | $101.00 |
| Client VPN | $252.00 |
| ALB | $20.38 |
| CloudWatch | $22.30 |
| ECR | $0.75 |
| **合計** | **$779.90** |

**POC期間（3ヶ月想定）**: **$2,339.70**

---

## 11.4 コスト最適化施策

### 11.4.1 即時実施可能な施策

| 施策 | 削減額（月額） | 実施難易度 |
|------|-------------|----------|
| **Client VPN削除（検証後）** | -$252.00 | 低 |
| **NAT Gateway 1台削除** | -$84.96 | 低（AZ冗長性犠牲） |
| **RDS t3.small へ変更** | -$61.20 | 低（性能低下） |
| **CloudWatch Logs保持期間3日** | -$10.00 | 低 |

**最大削減額**: **-$408.16**（52%削減）

### 11.4.2 将来検討施策

| 施策 | 削減額（月額） | 実施難易度 |
|------|-------------|----------|
| **Fargate Spot使用** | -$27.40（50%削減） | 中（本番非推奨） |
| **RDS Reserved Instance** | -$77.90（50%削減） | 低（1年契約） |
| **Savings Plans適用** | -$15.00（全体10%削減） | 低（1年契約） |

### 11.4.3 コスト削減vs品質トレードオフ

| 削減施策 | 影響 | 推奨 |
|---------|------|------|
| NAT Gateway削減 | 単一AZ障害時に影響 | ❌ 非推奨 |
| RDS t3.small | CPU性能低下、接続数減少 | ⚠️ 開発環境のみ |
| Client VPN削除 | 管理者アクセス不可 | ✅ 検証完了後OK |
| Fargate Spot | Task強制停止の可能性 | ⚠️ Batch のみ検討 |

---

## 11.5 コスト監視

### 11.5.1 AWS Cost Explorer設定

**推奨フィルター**:
| フィルター | 設定値 | 用途 |
|----------|--------|------|
| Service | ECS, RDS, EC2, VPC | サービス別コスト |
| Tag | Environment: dev | 環境別コスト |
| Tag | Project: sample-app | プロジェクト別コスト |

### 11.5.2 AWS Budgets設定

| Budget名 | 金額 | アラート |
|---------|------|---------|
| sample-app-monthly | $800/月 | 80%で警告、100%で緊急 |
| sample-app-daily | $30/日 | 100%で警告 |

**通知先**: ops-team@example.com

### 11.5.3 コスト異常検知

**AWS Cost Anomaly Detection**:
- 設定: 前週比20%増加で通知
- 通知先: ops-team@example.com

---

## 11.6 環境別コスト比較

### 11.6.1 開発環境（dev）vs 本番環境（prod）想定

| 項目 | dev | prod | 差分 |
|------|-----|------|------|
| ECS Fargate | $54.80 | $164.40（3倍） | +$109.60 |
| RDS | $155.80 | $466.80（3倍、r6g.large） | +$311.00 |
| NAT Gateway | $172.87 | $172.87 | $0.00 |
| Transit Gateway | $101.00 | $101.00 | $0.00 |
| Client VPN | $252.00 | $252.00 | $0.00 |
| ALB | $20.38 | $40.76（2台） | +$20.38 |
| CloudWatch | $22.30 | $66.90（3倍） | +$44.60 |
| **合計** | **$779.15** | **$1,264.73** | **+$485.58** |

---

## 11.7 ROI分析

### 11.7.1 POC投資対効果

**POC投資額**:
- 開発工数: 160時間（4週間 × 40h/週）
- AWS費用: $2,340（3ヶ月）
- **合計**: $2,340 + 人件費

**期待効果**:
| 効果 | 定量化 |
|------|--------|
| 技術検証完了 | 顧客提案時の技術的裏付け |
| ナレッジ蓄積 | 社内標準アーキテクチャ確立 |
| 開発速度向上 | 次回案件50%工数削減（想定） |
| 提案勝率向上 | 技術デモによる差別化 |

---

## 11.8 コスト削減チェックリスト

### 11.8.1 即時実施

- [ ] 未使用EIPの削除
- [ ] 未使用EBS Volumeの削除
- [ ] CloudWatch Logs保持期間見直し
- [ ] 開発環境の夜間停止（ECS Task停止）
- [ ] ECRイメージライフサイクルポリシー適用

### 11.8.2 定期レビュー（月次）

- [ ] Cost Explorer でサービス別コスト確認
- [ ] 未使用リソース確認（Trusted Advisor）
- [ ] RDS接続数確認（過剰スペック確認）
- [ ] ECS Task CPU/Memory使用率確認
- [ ] Data Transfer料金確認

---

**次へ**: [12_移行・展開戦略](12_移行・展開戦略.md)
