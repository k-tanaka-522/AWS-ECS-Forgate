# 05. セキュリティ設計

> AWS Multi-Account Sample Application - 基本設計書

[← 前へ: アプリケーション設計](04_アプリケーション設計.md) | [目次に戻る](00_目次.md) | [次へ: 監視・運用設計 →](06_監視・運用設計.md)

---

## 1. 認証設計

### 1.1 現フェーズ（検証・デモ用）

| サービス | 認証方式 |
|---------|---------|
| Public Web | 認証なし |
| Admin Dashboard | Basic認証（検討中） |

### 1.2 将来的な本番化対応

- AWS Cognito User Pools
- MFA（多要素認証）
- SAML 2.0（企業SSO連携）

---

## 2. 認可設計

### 2.1 現フェーズ

- RBAC（Role-Based Access Control）は未実装
- Admin Dashboardは全機能アクセス可能

### 2.2 将来的な本番化対応

- RBAC実装（Admin/Operator/Viewer）
- AWS IAM Identity Center統合

---

## 3. データ暗号化

| 項目 | 暗号化方式 | 適用箇所 |
|------|-----------|---------|
| **通信暗号化** | TLS 1.2以上 | ALB HTTPS Listener |
| **保存データ暗号化** | AES-256 | RDS PostgreSQL（KMS暗号化） |
| **EBS暗号化** | AES-256 | ECS Fargateは暗号化済み |
| **S3暗号化** | AES-256（SSE-S3） | ALBログ、VPCフローログ |

---

## 4. シークレット管理

**参照標準**: `.claude/docs/40_standards/45_secrets-management.md`

### 4.1 管理方法

| シークレット種別 | 管理方法 | 備考 |
|---------------|---------|------|
| DBパスワード | AWS Secrets Manager | 自動生成、32文字 |
| APIキー | AWS Secrets Manager | - |
| TLS証明書 | AWS Certificate Manager | Client VPN用 |

### 4.2 CloudFormationでの参照

```yaml
# Dynamic Reference使用
MasterUserPassword: !Sub '{{resolve:secretsmanager:${DBSecret}:SecretString:password}}'
```

### 4.3 ECS Task Definitionでの参照

```yaml
Secrets:
  - Name: DB_PASSWORD
    ValueFrom: !Sub '{{resolve:secretsmanager:${DBSecret}:SecretString:password}}'
```

---

## 5. 監査ログ

| ログ種別 | 出力先 | 保持期間 | 用途 |
|---------|--------|---------|------|
| アプリケーションログ | CloudWatch Logs | 30日 | エラー追跡、デバッグ |
| ALBアクセスログ | S3 | 90日 | アクセス分析 |
| VPCフローログ | CloudWatch Logs | 30日 | ネットワーク監視 |
| CloudTrail | S3 | 1年 | API監査（将来実装） |

---

## 6. セキュリティ標準準拠確認

**参照**: `.claude/docs/40_standards/49_security.md`

**チェックリスト:**

- [x] シークレット情報をハードコードしない → Secrets Manager使用
- [x] 通信はTLS 1.2以上 → ALB HTTPS Listener
- [x] データ保存時暗号化 → RDS KMS暗号化
- [x] 最小権限の原則 → SecurityGroup、IAM Role
- [ ] CloudTrail有効化 → 将来実装（検証用のため未実装）
- [x] VPCフローログ有効化 → CloudWatch Logs出力

---

## 7. ネットワークセキュリティ

### 7.1 SecurityGroup設計（再掲）

| SecurityGroup | Ingress | Egress | 用途 |
|--------------|---------|--------|------|
| ALB Public | 0.0.0.0/0:443 | All | Public Web用 |
| ALB Admin | 10.0.0.0/16:443 | All | Admin用（VPN経由のみ） |
| ECS Public | ALB Public SG:8080 | All | Public Web ECS |
| ECS Admin | ALB Admin SG:8080 | All | Admin ECS |
| RDS | ECS SG:5432 | - | PostgreSQL |
| Client VPN | 172.16.0.0/22:All | All | VPN Endpoint |

### 7.2 Admin Dashboardアクセス制限

**重要**: Admin DashboardはVPN経由のみアクセス可能

```
管理者
  ↓ VPN接続
Client VPN Endpoint (Platform Account)
  ↓ Transit Gateway
Service VPC (Service Account)
  ↓ ALB (Admin) - SecurityGroup: 10.0.0.0/16:443のみ許可
ECS Fargate (Admin)
```

---

## 8. 次のステップ

セキュリティ設計を理解したら、次は監視・運用設計を確認します。

**次のドキュメント**: [06_監視・運用設計.md](06_監視・運用設計.md)

---

**ドキュメントナビゲーション**:
- [← 前へ: アプリケーション設計](04_アプリケーション設計.md)
- [目次に戻る](00_目次.md)
- [次へ: 監視・運用設計 →](06_監視・運用設計.md)
